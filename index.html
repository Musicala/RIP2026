<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light" />
  <title>RIP 2026</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand-title">RIP 2026</div>
      <div class="brand-sub">Base de datos + ficha por estudiante (solo lectura)</div>
    </div>

    <div class="top-actions">
      <button class="btn ghost" id="btnPago" type="button">üí≥ Registrar pago</button>
      <button class="btn ghost" id="btnClases" type="button">üìù Registrar clases</button>
      <button class="btn ghost" id="btnProgramacion" type="button">üìÖ Programaci√≥n</button>
      <button class="btn primary" id="btnRefresh" type="button">Actualizar datos</button>
      <button class="btn" id="btnVerBase" type="button">Ver base de datos</button>
      <span class="pill" id="badgeMode">TSV</span>
      <span class="pill soft" id="badgeCount">0 registros</span>
    </div>

    <div class="dashTabs" id="dashTabs">
      <button id="dashTabClas" class="tab active" type="button">Clasificaci√≥n</button>
      <button id="dashTabSaldo" class="tab" type="button">Saldos</button>
    </div>

    <h2 id="dashTitle">Dashboard ¬∑ Clasificaci√≥n</h2>
    <p id="dashSub">Agrupado por Activos / Por revisar / Inactivos. Click para ver lista de estudiantes.</p>
  </header>

  <main class="page">

    <section class="card" id="filtersCard">
      <div class="filters-grid">

        <div class="fgrp">
          <div class="flabel">üë§ Estudiante</div>
          <input id="fStudent" class="fctrl" list="nombresLista" placeholder="Escribe un nombre‚Ä¶" autocomplete="off" />
          <datalist id="nombresLista"></datalist>
        </div>

        <div class="fgrp">
          <div class="flabel">üéõÔ∏è Servicio <span class="fcount" id="fServiceCount">0</span></div>

          <div class="multi" id="serviceMulti">
            <button type="button" class="multi-btn" id="serviceBtn">
              Selecciona servicio(s) ‚ñæ
            </button>

            <div class="multi-pop" id="servicePop" aria-hidden="true">
              <div class="multi-search">
                <input id="serviceSearch" class="multi-search-input" type="text" placeholder="Buscar servicio..." />
                <button class="btn small" id="serviceClear" type="button">Limpiar</button>
              </div>
              <div class="multi-list" id="serviceList"></div>
            </div>
          </div>
        </div>

        <div class="fgrp">
          <div class="flabel">üè´ Profesor</div>
          <select id="fProfesor" class="fctrl">
            <option value="">Todos</option>
          </select>
        </div>

        <div class="fgrp">
          <div class="flabel">üè∑Ô∏è Tipo</div>
          <select id="fTipo" class="fctrl">
            <option value="">Todos</option>
            <option value="Clase">Clase</option>
            <option value="Pago">Pago</option>
          </select>
        </div>

        <div class="fgrp">
          <div class="flabel">üìÖ Desde</div>
          <input id="fDesde" class="fctrl" type="date" />
        </div>

        <div class="fgrp">
          <div class="flabel">üìÖ Hasta</div>
          <input id="fHasta" class="fctrl" type="date" />
        </div>

      </div>

      <div class="filters-actions">
        <button class="btn primary" id="btnPDFTop" type="button">üìÑ Descargar PDF</button>
        <button class="btn ghost" id="btnTop2025" type="button" style="display:none">üóÇÔ∏è 2025</button>
        <button class="btn" id="btnApply" type="button">‚ôªÔ∏è Aplicar filtros</button>
        <button class="btn ghost" id="btnReset" type="button">üßº Limpiar</button>
        <span class="status" id="status">Cargando‚Ä¶</span>
      </div>
    </section>

    <section class="tabs" id="dashTabsMid">
      <button class="tab active" id="tabClas" type="button">Estudiantes (Clasificaci√≥n)</button>
      <button class="tab" id="tabSaldos" type="button">Saldos (Deben / Se acab√≥ / Les debemos)</button>
      <div class="tabs-spacer"></div>
      <button class="btn small" id="btnBackToDash" title="Volver a dashboard" style="display:none" type="button">Volver</button>
    </section>

    <section class="card" id="dashboardClasView">
      <div class="card-title">
        <h3 id="dashClasTitle">Dashboard de estudiantes</h3>
        <p class="muted" id="dashSubClas">Todo es clickable.</p>
      </div>
      <div class="grid" id="dashGridClas"></div>
    </section>

    <section class="card" id="dashboardSaldoView" style="display:none">
      <div class="card-title">
        <h3>Dashboard de saldos</h3>
        <p class="muted" id="dashSubSaldo">Basado en SUM(Movimiento) por estudiante.</p>
      </div>

      <div class="kpis" id="dashKpisSaldo"></div>
      <div class="grid" id="dashGridSaldo"></div>
    </section>

    <section class="card" id="fichaView" style="display:none">
      <div class="card-title">
        <h3 id="fichaTitle">Ficha</h3>
        <p class="muted" id="fichaSub">Resumen + registro</p>
      </div>

      <div class="sheet-like">
        <div class="sheet-row sheet-head">
          <div class="cell strong">Estudiante</div>
          <div class="cell" id="fichaStudent">‚Äî</div>
          <div class="cell strong">√öltima fecha</div>
          <div class="cell" id="fichaFecha">‚Äî</div>
        </div>

        <div class="sheet-row">
          <div class="cell strong">Saldo total (SUM Movimiento)</div>
          <div class="cell" id="fichaUltPago">‚Äî</div>
          <div class="cell strong">Clasificaci√≥n (Par√°metros)</div>
          <div class="cell" id="fichaProxPago">‚Äî</div>
        </div>

        <div class="sheet-row sheet-subhead">
          <div class="cell strong">Detalle por Clasificaci√≥n / Clasificaci√≥n pagos</div>
          <div class="cell" style="grid-column: span 3;" id="fichaSaldosMini"></div>
        </div>
      </div>

      <div class="table-wrap" id="tablaContainer">
        <table class="tbl">
          <thead>
            <tr>
              <th>Estudiante</th>
              <th>Tipo</th>
              <th>Fecha</th>
              <th>Hora</th>
              <th>Servicio</th>
              <th>Profesor</th>
              <th>Pago</th>
              <th>Comentario</th>
              <th>ID</th>
              <th>Clasificaci√≥n</th>
              <th>Clasif. pagos</th>
              <th>Movimiento</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>

      <div class="ficha-actions">
        <button class="btn ghost" id="btn2025" style="display:none" type="button">2025</button>
        <button class="btn" id="btnPDF" type="button">Descargar PDF</button>
        <button class="btn ghost" id="btnVolverDash" type="button">Volver al dashboard</button>
      </div>
    </section>

    <!-- Vista: Programaci√≥n (trasplante limpio) -->
    <section class="card" id="programacionView" style="display:none">
      <div class="card-head prog-head">
        <div>
          <h2 class="prog-title">Programaci√≥n</h2>
          <p class="muted prog-sub">M√≥dulo trasplantado dentro del RIP (misma navegaci√≥n de vistas).</p>
        </div>
        <div class="top-actions">
          <button class="btn small ghost" id="btnBackFromProgramacion" type="button">‚Üê Volver</button>
        </div>
      </div>

      <div class="prog-shell">
        <div class="prog-top">

    <div class="brand">
      <div class="title" id="subtitle">Programaci√≥n ¬∑ Musicala</div>
      <div class="statusline" id="statusline">Listo.</div>
    </div>

    <div class="actions">
      <button class="btn ghost" id="reload" title="Recargar datos">‚Üª Recargar</button>
      <input id="q" class="search" placeholder="Buscar estudiante..." />
      <button class="btn" id="goProg">Programar</button>
      <button class="btn" id="goReprog">Reprogramar</button>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="dash">Dashboard</button>
      <button class="tab" data-tab="prog">Programar</button>
      <button class="tab" data-tab="reprog">Reprogramar</button>
    </div>

        </div>

        <div class="prog-body">

    <!-- DASHBOARD -->
    <section id="tab-dash">
      <div class="grid">
        <section class="card">
          <div class="card-h">
            <h2>Activos</h2>
            <div class="meta" id="metaDash"></div>
          </div>
          <div class="card-b">

            <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:12px">
              <div class="pill" title="Buscar por estudiante o estado">
                üîé <span style="opacity:.75">Filtro:</span>
                <strong id="kAct">Activos</strong>
              </div>
              <div class="pill" title="En riesgo: sin programaci√≥n o sin futuras">
                ‚ö†Ô∏è <span style="opacity:.75">Riesgo:</span>
                <strong id="kRisk">0</strong>
              </div>
              <div class="pill" title="M√≠nimo de clases futuras recomendado">
                üìÖ <span style="opacity:.75">M√≠n. futuras:</span>
                <input id="minFuture" type="number" min="0" value="2" style="width:70px; height:28px; padding:0 8px" />
              </div>
            </div>

            <div class="tablewrap">
              <table>
                <thead>
                  <tr>
                    <th>Estudiante</th>
                    <th>Estado</th>
                    <th>Programaci√≥n</th>
                    <th>Futuras</th>
                    <th>Acci√≥n</th>
                  </tr>
                </thead>
                <tbody id="tbody"></tbody>
              </table>
            </div>

          </div>
        </section>

        <section class="card">
          <div class="card-h">
            <h2>Detalle</h2>
            <div class="meta" id="detailMeta"></div>
          </div>
          <div class="card-b">
            <div class="detail">
              <div><div class="label">Estudiante</div><div class="val" id="detailName">‚Äî</div></div>
              <div><div class="label">Estado</div><div class="val" id="detailState">‚Äî</div></div>
              <div><div class="label">Fechas programadas</div><div class="val" id="detailDates">‚Äî</div></div>
            </div>

            <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
              <button class="btn" id="progLoadCurrent">Cargar en Programar</button>
              <button class="btn ghost" id="repLoad">Cargar en Reprogramar</button>
            </div>
          </div>
        </section>
      </div>
    </section>

    <!-- PROGRAMAR -->
    <section id="tab-prog" style="display:none">
      <div class="grid">
        <section class="card full">
          <div class="card-h">
            <h2>Programar sesiones</h2>
            <div class="meta" id="progMeta"></div>
          </div>
          <div class="card-b">

            <div class="form">
              <div>
                <label>Estudiante</label>
                <input id="progStudent" list="studentList" placeholder="Escribe y elige..." />
                <datalist id="studentList"></datalist>
              </div>

              <div>
                <label>Paquete</label>
                <select id="progPkg">
                  <option value="4">4 clases</option>
                  <option value="8">8 clases</option>
                  <option value="12">12 clases</option>
                  <option value="24">24 clases</option>
                </select>
              </div>

              <div>
                <label>Frecuencia</label>
                <select id="progFreq">
                  <option value="1">Semanal</option>
                  <option value="2">2x semana</option>
                  <option value="3">3x semana</option>
                </select>
              </div>

              <div>
                <label>Inicio (fecha)</label>
                <input id="progStart" type="date" />
              </div>

              <div>
                <label>Evitar domingos</label>
                <select id="progAvoidSun">
                  <option value="1">S√≠</option>
                  <option value="0">No</option>
                </select>
              </div>

              <div style="display:flex; align-items:flex-end; gap:10px; flex-wrap:wrap">
                <button class="btn" id="progGen">Generar</button>
                <button class="btn ghost" id="progClear">Limpiar</button>
                <button class="btn" id="progSave">Guardar en hoja</button>
                <span class="meta" id="progStatus"></span>
              </div>
            </div>

            <div class="tablewrap" style="margin-top:12px">
              <table>
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>Servicio</th>
                    <th>Profesor</th>
                    <th>Comentario</th>
                  </tr>
                </thead>
                <tbody id="progList"></tbody>
              </table>
            </div>

          </div>
        </section>
      </div>
    </section>

    <!-- REPROGRAMAR -->
    <section id="tab-reprog" style="display:none">
      <div class="grid">
        <section class="card full">
          <div class="card-h">
            <h2>Reprogramar</h2>
            <div class="meta" id="repPreviewMeta"></div>
          </div>
          <div class="card-b">

            <div class="form">
              <div>
                <label>Estudiante</label>
                <input id="repStudent" list="studentList" placeholder="Escribe y elige..." />
              </div>

              <div>
                <label>Fecha base (desde)</label>
                <input id="repBase" type="date" />
              </div>

              <div>
                <label>Cantidad</label>
                <input id="repCount" type="number" min="1" value="4" />
              </div>

              <div>
                <label>Frecuencia</label>
                <select id="repFreq">
                  <option value="1">Semanal</option>
                  <option value="2">2x semana</option>
                  <option value="3">3x semana</option>
                </select>
              </div>

              <div>
                <label>Evitar domingos</label>
                <select id="repAvoidSun">
                  <option value="1">S√≠</option>
                  <option value="0">No</option>
                </select>
              </div>

              <div style="display:flex; align-items:flex-end; gap:10px; flex-wrap:wrap">
                <button class="btn" id="repPreview">Previsualizar</button>
                <button class="btn ghost" id="repClear">Limpiar</button>
                <button class="btn" id="repRegen">Regenerar</button>
                <button class="btn" id="repSave">Guardar</button>
                <span class="meta" id="repStatus"></span>
              </div>
            </div>

            <div class="tablewrap" style="margin-top:12px">
              <table>
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Antes</th>
                    <th>Despu√©s</th>
                  </tr>
                </thead>
                <tbody id="repPreview"></tbody>
              </table>
            </div>

          </div>
        </section>
      </div>
    </section>

        </div>
      </div>
    </section>

  </main>

  <div class="toast-wrap" id="toastWrap"></div>

  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

  <script src="./rip.core.js?v=2026.3"></script>

  <script src="./ui.shared.js?v=2026.3"></script>
  <script src="./ui.dashboard.js?v=2026.3"></script>
  <script src="./ui.ficha.js?v=2026.3"></script>
  <script src="./ui.table.js?v=2026.3"></script>
  <script src="./ui.programacion.js?v=2026.3"></script>

  <script>
    window.PAYMENT_WEBAPP_URL = "https://musicala.github.io/registrodepagos2026/";
    window.REGISTRAR_CLASES_URL = "https://musicala.github.io/RegistroWix2026/";
  </script>

  <script src="./app.js?v=2026.3"></script>
</body>
</html>
